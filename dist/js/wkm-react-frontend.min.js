/*!
 * WKM Frontend v0.0.0 (http://www.wkm.com.br)
 * Copyright 2015-2015 Pedro Jesus <pjesus@wkm.com.br>
 */
$.extend(FormSerializer.patterns,{validate:/^[a-z_][a-z0-9#_\.-]*(?:\[(?:\d*|[a-z0-9#_\.-]+)\])*$/i,key:/[a-z0-9#_\.-]+|(?=\[\])/gi,named:/^[a-z0-9#_\.-]+$/i});var WRF={};WRF.config={theme:"materialize"},WRF.themes={},WRF.getTheme=function(){var a=WRF.themes["default"],b=WRF.themes[WRF.config.theme];return $.extend({},a,b)},WRF.themeProp=function(a,b){if(!a)return"";void 0===b&&(b=this.getTheme());var c=a.split("."),d=b;try{for(;c.length>0;)d=d[c.shift()]}catch(e){return""}return d},WRF.themeClass=function(a){for(var b=this.getTheme(),c=a.split(" "),d="";c.length>0;){var e=c.shift(),f=e+".cssClass";d+=WRF.themeProp(f,b)+" "}return d},WRF.themes["default"]={grid:{cssClass:"grid",row:{cssClass:"row"},filter:{wrapper:{cssClass:"grid__filter"},buttonGroup:{cssClass:"filter__button-group"},clearButton:{cssClass:"filter__button--clear"}},table:{cssClass:"",wrapper:{cssClass:"grid__table"},header:{cssClass:"table-header",label:{cssClass:"table-header__name"}},cell:{cssClass:"table-cell",text:{cssClass:"table-cell--text"},currency:{cssClass:"table-cell--currency"},number:{cssClass:"table-cell--number"},"boolean":{cssClass:"table-cell--boolean"},datetime:{cssClass:"table-cell--datetime"}}},pagination:{wrapper:{cssClass:"grid__pagination"}}},form:{cssClass:""},button:{cssClass:"",cancel:{cssClass:""}}},WRF.themes.materialize={grid:{cssClass:"grid",row:{cssClass:"row"},filter:{wrapper:{cssClass:"grid__filter"},buttonGroup:{cssClass:"filter__button-group col s12 m12 l12 right-align"},clearButton:{cssClass:"filter__button--clear"}},table:{cssClass:"striped responsive-table",wrapper:{cssClass:"grid__table"},header:{cssClass:"table-header",label:{cssClass:"table-header__name"}},cell:{cssClass:"table-cell",text:{cssClass:"table-cell--text"},currency:{cssClass:"table-cell--currency"},number:{cssClass:"table-cell--number"},"boolean":{cssClass:"table-cell--boolean"},datetime:{cssClass:"table-cell--datetime"}}},pagination:{wrapper:{cssClass:"grid__pagination"}}},form:{cssClass:""},button:{cssClass:"btn waves-effect waves-light",cancel:{cssClass:"grey lighten-4"}},pagination:{cssClass:"pagination",item:{cssClass:"waves-effect",disabled:{cssClass:"disabled"},active:{cssClass:"active"}}},icon:{cssClass:"material-icons",left:"chevron-left",right:"chevron-right"}};var CssClassMixin={getDefaultProps:function(){return{clearTheme:!1,className:""}},className:function(){var a="";return!this.props.clearTheme&&this.state.themeClassKey&&(a+=WRF.themeClass(this.state.themeClassKey)+" "),a+=this.props.className}},Button=React.createClass({displayName:"Button",propTypes:{name:React.PropTypes.string,type:React.PropTypes.string,icon:React.PropTypes.string,className:React.PropTypes.string,onClick:React.PropTypes.func},getDefaultProps:function(){return{className:""}},render:function(){return React.createElement("button",{className:this.className(),type:this.props.type,onClick:this.props.onClick},this.props.name,this.renderIcon())},renderIcon:function(){var a=this.props.icon;return a?React.createElement("i",{className:"material-icons right"},a):""},className:function(){var a=WRF.themeClass("button");return a+=" "+this.props.className}}),Form=React.createClass({displayName:"Form",propTypes:{inputs:React.PropTypes.object,action:React.PropTypes.string,method:React.PropTypes.string,dataType:React.PropTypes.string,onSuccess:React.PropTypes.func,onError:React.PropTypes.func,onSubmit:React.PropTypes.func,onReset:React.PropTypes.func},getDefaultProps:function(){return{action:"",method:"POST",dataType:"json",onSuccess:function(a){return!0},onError:function(a,b,c){return!0},onSubmit:function(a){return!0},onReset:function(a){return!0}}},render:function(){return React.createElement("form",{action:this.props.action,id:this.props.id,onSubmit:this.handleSubmit,onReset:this.props.onReset,ref:"form"},this.renderInputs(),this.props.children)},renderInputs:function(){var a=this.props.inputs,b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(React.createElement(Input,React.__spread({},d,{id:c,key:c,ref:"input_"+c})))}return b},serialize:function(){var a=React.findDOMNode(this.refs.form);return $(a).serializeObject()},handleSubmit:function(a){if(a.preventDefault(),this.props.onSubmit(a)){var b=this.serialize();this.submit(b)}},submit:function(a){$.ajax({url:this.props.action,method:this.props.method,dataType:this.props.dataType,data:a,success:function(a){this.props.onSuccess(a)}.bind(this),error:function(a,b,c){this.props.onError(a,b,c)}.bind(this)})}}),Grid=React.createClass({displayName:"Grid",mixins:[CssClassMixin],propTypes:{url:React.PropTypes.string,paginationConfigs:React.PropTypes.object,sortConfigs:React.PropTypes.object,sortData:React.PropTypes.object,filterForm:React.PropTypes.object,columns:React.PropTypes.object,data:React.PropTypes.object,dataRowsKey:React.PropTypes.string},getDefaultProps:function(){return{dataRowsKey:"data",paginationConfigs:{pageParam:"p"},sortConfigs:{param:"s",valueFormat:"%{field} %{direction}"},sortData:{},filterForm:{inputs:{name:{label:"Nome"}}},columns:{name:{label:"Nome"}},data:{dataRows:[],count:0}}},getInitialState:function(){return{dataRows:this.props.data.dataRows,count:this.props.data.count,page:1,filterData:{},sortData:this.props.sortData,themeClassKey:"grid"}},render:function(){return React.createElement("div",{className:this.className()},this.renderFilter(),this.renderPagination(),this.renderTable(),this.renderPagination())},renderFilter:function(){return React.createElement("div",{className:this.props.clearTheme?"":WRF.themeClass("grid.filter.wrapper grid.row")},React.createElement(GridFilter,{form:this.props.filterForm,url:this.props.url,onSubmit:this.onFilterSubmit,ref:"gridFilter"}))},renderTable:function(){return React.createElement("div",{className:this.props.clearTheme?"":WRF.themeClass("grid.table.wrapper grid.row")},React.createElement(GridTable,{columns:this.props.columns,sortConfigs:this.props.sortConfigs,sortData:this.state.sortData,dataRows:this.state.dataRows,onSort:this.onSort,ref:"gridTable"}))},renderPagination:function(){var a=this.state.count,b=this.state.dataRows.length;return b>=a?null:React.createElement("div",{className:this.props.clearTheme?"":WRF.themeClass("grid.pagination.wrapper grid.row")},React.createElement(Pagination,React.__spread({},this.props.paginationConfigs,{page:this.state.page,count:this.state.count,onPagination:this.onPagination})))},onPagination:function(a){this.state.page=a,this.loadData()},onFilterSubmit:function(a){return this.state.filterData=this.refs.gridFilter.serialize(),this.state.page=1,this.loadData(),!1},onSort:function(a){this.state.sortData=a,this.state.page=1,this.loadData()},loadData:function(){var a=this.buildPostData();$.ajax({url:this.props.url,method:"GET",dataType:"json",data:a,success:function(a){this.dataLoaded(a)}.bind(this),error:function(a,b,c){console.log("Grid Load error:"+c)}.bind(this)})},dataLoaded:function(a){this.setState({dataRows:a[this.props.dataRowsKey],count:a.count})},buildPostData:function(){var a=$.extend({},this.state.filterData);return a[this.props.paginationConfigs.pageParam]=this.state.page,$.isEmptyObject(this.state.sortData)||$.extend(a,this.buildSortPostData()),a},buildSortPostData:function(){var a=this.props.sortConfigs.param,b={};return b[a]=this.parseSortPostDataValue(),b},parseSortPostDataValue:function(){var a=this.props.sortConfigs.valueFormat,b=this.state.sortData.field,c=this.state.sortData.direction;return a.replace(/%\{field}/,b).replace(/%\{direction}/,c)}}),GridFilter=React.createClass({displayName:"GridFilter",propTypes:{form:React.PropTypes.object,url:React.PropTypes.string,method:React.PropTypes.string,submitButton:React.PropTypes.object,clearButton:React.PropTypes.object,onSuccess:React.PropTypes.func,onError:React.PropTypes.func,onSubmit:React.PropTypes.func},getDefaultProps:function(){return{form:{},method:"GET",submitButton:{name:"Filtrar",icon:"search"},clearButton:{name:"Limpar",className:WRF.themeClass("grid.filter.clearButton button.cancel")},onSuccess:function(a){return!0},onError:function(a,b,c){return!0},onSubmit:function(a){return!0}}},render:function(){return React.createElement(Form,React.__spread({},this.props.form,{action:this.props.url,method:this.props.method,onSuccess:this.props.onSuccess,onError:this.props.onError,onSubmit:this.props.onSubmit,ref:"form"}),this.props.children,React.createElement("div",{className:WRF.themeClass("grid.filter.buttonGroup")},React.createElement(Button,React.__spread({},this.props.clearButton,{type:"reset"})),React.createElement(Button,React.__spread({},this.props.submitButton,{type:"submit"}))))},serialize:function(){return this.refs.form.serialize()}}),GridTable=React.createClass({displayName:"GridTable",propTypes:{columns:React.PropTypes.object,sortConfigs:React.PropTypes.object,sortData:React.PropTypes.object,dataRows:React.PropTypes.array,onSort:React.PropTypes.func},getDefaultProps:function(){return{columns:{},sortConfigs:{},sortData:{},dataRows:[],onSort:function(a){return!0}}},render:function(){return React.createElement("table",{className:WRF.themeClass("grid.table")},React.createElement("thead",null,this.renderTableHeaders()),React.createElement("tbody",null,this.props.dataRows.length>0?this.renderTableRows():this.renderEmptyMessage()))},renderTableHeaders:function(){var a=this.props.columns,b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(React.createElement(GridTableHeader,React.__spread({},d,this.props.sortConfigs,{name:c,key:c,sortDirection:this.sortDirectionForColumn(c),ref:"header_"+c,onSort:this.props.onSort})))}return React.createElement("tr",null,b)},sortDirectionForColumn:function(a){var b=this.props.sortData;return b.field&&b.field==a?b.direction:null},renderTableRows:function(){for(var a=[],b=this.props.dataRows,c=0;c<b.length;c++){var d=b[c];a.push(React.createElement(GridTableRow,{columns:this.props.columns,data:d,key:"table_row_"+c}))}return a},renderEmptyMessage:function(){var a=0;for(var b in this.props.columns)a++;return React.createElement("tr",null,React.createElement("td",{colSpan:a},"Nenhum resultado foi encontrado."))}}),GridTableCell=React.createClass({displayName:"GridTableCell",validFormats:["text","currency","number","boolean","datetime"],propTypes:{name:React.PropTypes.string,data:React.PropTypes.object,value:React.PropTypes.func,format:React.PropTypes.string},getDefaultProps:function(){return{format:"text"}},render:function(){return React.createElement("td",{className:this.cssClass()},this.renderValue())},cssClass:function(){return WRF.themeClass("grid.table.cell grid.table.cell."+this.props.format)},renderValue:function(){var a=this.props.format,b=this.props.value;return b?b(this.props.data):$.inArray(a,this.validFormats)>=0?this[a+"Value"]():this.textValue()},textValue:function(){return this.props.data[this.props.name]},numberValue:function(){var a=parseFloat(this.props.data[this.props.name]);return numeral(a).format("0,0.[000]")},currencyValue:function(){var a=parseFloat(this.props.data[this.props.name]);return numeral(a).format("$ 0,0.00")},booleanValue:function(){var a=this.props.data[this.props.name];return a?"Sim":"Não"},datetimeValue:function(){var a=moment(this.props.data[this.props.name]);return a.format("DD/MM/YYYY HH:mm")}}),GridTableHeader=React.createClass({displayName:"GridTableHeader",propTypes:{name:React.PropTypes.string,label:React.PropTypes.string,sortable:React.PropTypes.bool,sortDirection:React.PropTypes.string,onSort:React.PropTypes.func},getDefaultProps:function(){return{sortable:!0,sortDirection:null,onSort:function(a){return!0}}},render:function(){return React.createElement("th",{className:WRF.themeClass("grid.table.header")},React.createElement("span",{onClick:this.sortColumn,className:this.className()},this.props.label||this.props.name))},className:function(){var a=WRF.themeClass("grid.table.header.label");if(this.props.sortable){a+=" sortable";var b=this.props.sortDirection;null!==b&&(a+=" "+b)}return a},sortColumn:function(){if(!this.props.sortable)return null;var a=this.buildSortData();this.props.onSort(a)},buildSortData:function(){var a=this.props.name,b=this.getSortDirection();return{field:a,direction:b}},getSortDirection:function(){var a=this.props.sortDirection;return null===a||"desc"==a?"asc":"asc"==a?"desc":void 0}}),GridTableRow=React.createClass({displayName:"GridTableRow",propTypes:{columns:React.PropTypes.object,data:React.PropTypes.object},render:function(){return React.createElement("tr",null,this.renderCells())},renderCells:function(){var a=this.props.columns,b=[];for(var c in a)if(a.hasOwnProperty(c)){var d=a[c];b.push(React.createElement(GridTableCell,React.__spread({},d,{name:c,data:this.props.data,key:c})))}return b}}),Icon=React.createClass({displayName:"Icon",mixins:[CssClassMixin],propTypes:{iconType:React.PropTypes.string},getDefaultProps:function(){return{iconType:""}},getInitialState:function(){return{themeClassKey:"icon"}},render:function(){return React.createElement("i",{className:this.className()},WRF.themeProp(this.prop.iconType))}}),Input=React.createClass({displayName:"Input",propTypes:{id:React.PropTypes.string,name:React.PropTypes.string,label:React.PropTypes.string,value:React.PropTypes.string,onChange:React.PropTypes.func,component:React.PropTypes.string,componentMapping:React.PropTypes.func},getDefaultProps:function(){return{value:null,onChange:function(a){return!0},component:"text",componentMapping:function(a){var b={text:InputText,checkbox:InputCheckbox,select:InputSelect,hidden:InputHidden};return b[a]}}},getInitialState:function(){return{value:this.props.value}},render:function(){return"hidden"===this.props.component?this.renderHiddenInput():this.renderVisibleInput()},renderVisibleInput:function(){return React.createElement("div",{className:"input-field col l3 m4 s12"},this.renderComponentInput(),React.createElement("label",{htmlFor:this.props.id},this.labelValue()))},renderHiddenInput:function(){return this.renderComponentInput()},renderComponentInput:function(){var a=this.props.componentMapping(this.props.component),b=this.props.name||this.props.id,c=React.__spread({},this.props,{name:b});return React.createElement(a,c)},labelValue:function(){return this.props.label||this.props.name}}),InputCheckbox=React.createClass({displayName:"InputCheckbox",propTypes:{id:React.PropTypes.string,name:React.PropTypes.string,value:React.PropTypes.string,onChange:React.PropTypes.func},getDefaultProps:function(){return{disabled:!1}},componentDidMount:function(){React.findDOMNode(this.refs.checkbox).indeterminate=!0},render:function(){return React.createElement("input",{id:this.props.id,name:this.props.name,onChange:this.props.onChange,type:"checkbox",className:"validate",ref:"checkbox"})}}),InputHidden=React.createClass({displayName:"InputHidden",propTypes:{id:React.PropTypes.string,name:React.PropTypes.string,value:React.PropTypes.string},render:function(){return React.createElement("input",{id:this.props.id,name:this.props.name,value:this.props.value,type:"hidden"})}}),InputSelect=React.createClass({displayName:"InputSelect",propTypes:{id:React.PropTypes.string,name:React.PropTypes.string,value:React.PropTypes.string,options:React.PropTypes.array,optionsUrl:React.PropTypes.string,dependsOn:React.PropTypes.object,includeBlank:React.PropTypes.bool,disabled:React.PropTypes.bool,onChange:React.PropTypes.func},getDefaultProps:function(){return{includeBlank:!0,disabled:!1,dependsOn:null,options:[]}},getInitialState:function(){return{options:this.props.options,disabled:this.props.disabled}},componentWillMount:function(){this.props.dependsOn&&(this.state.disabled=!0)},componentDidMount:function(){this.applyMaterialize(),this.props.optionsUrl&&(this.props.dependsOn?this.listenDependableChanges():this.loadOptions())},componentDidUpdate:function(a,b){var c=this.state;c.options!=b.options&&this.applyMaterialize()},render:function(){return React.createElement("select",{id:this.props.id,name:this.props.name,value:this.props.value,onChange:this.props.onChange,disabled:this.state.disabled,ref:"select"},this.renderOptions())},handleChange:function(a){var b=React.findDOMNode(this.refs.select),c=$(b);c.trigger("dependable_changed",[b.value]),this.props.onChange(a)},renderOptions:function(){var a=[],b=this.state.options;this.props.includeBlank&&a.push(React.createElement(InputSelectOption,{name:"Selecione",value:"",key:"empty_option"}));for(var c=0;c<b.length;c++){var d=b[c];a.push(React.createElement(InputSelectOption,React.__spread({},d,{key:d.name})))}return a},loadOptions:function(a){$.ajax({url:this.props.optionsUrl,method:"GET",dataType:"json",data:a,success:this.loadOptionsCallback,error:function(a,b,c){console.log("InputSelect Load error:"+c)}.bind(this)})},loadOptionsCallback:function(a){for(var b="name",c="id",d=[],e=0;e<a.length;e++){var f=a[e],g={name:String(f[b]),value:String(f[c])};d.push(g)}this.setState({options:d,disabled:!!this.props.dependsOn&&d.length<=0})},listenDependableChanges:function(){var a=this.props.dependsOn,b=a.dependableId,c=a.paramName||b,d=document.getElementById(b);$(d).on("dependable_changed",function(a,b){if(!b)return this.emptyAndDisable(),!1;var d={};d[c]=b,this.loadOptions(d)}.bind(this))},emptyAndDisable:function(){this.setState({options:[],disabled:!0})},applyMaterialize:function(){var a=React.findDOMNode(this.refs.select);$(a).material_select(this.handleChangeMaterialize.bind(this,a)),this.handleChangeMaterialize(a)},handleChangeMaterialize:function(a){var b=$(a),c={currentTarget:a};b.parent().parent().find("> .caret").remove(),b.trigger("dependable_changed",[a.value]),this.props.onChange(c)}}),InputSelectOption=React.createClass({displayName:"InputSelectOption",propTypes:{name:React.PropTypes.string,value:React.PropTypes.string},render:function(){return React.createElement("option",{value:this.props.value},this.props.name)}}),InputText=React.createClass({displayName:"InputText",propTypes:{id:React.PropTypes.string,name:React.PropTypes.string,value:React.PropTypes.string,placeholder:React.PropTypes.string,disabled:React.PropTypes.bool,onChange:React.PropTypes.func},getDefaultProps:function(){return{disabled:!1}},render:function(){return React.createElement("input",{placeholder:this.props.placeholder,id:this.props.id,name:this.props.name,value:this.props.value,onChange:this.props.onChange,disabled:this.props.disabled,type:"text",className:"validate"})}}),Pagination=React.createClass({displayName:"Pagination",mixins:[CssClassMixin],propTypes:{count:React.PropTypes.number,page:React.PropTypes.number,perPage:React.PropTypes.number,window:React.PropTypes.number,onPagination:React.PropTypes.func},getDefaultProps:function(){return{page:1,perPage:20,window:4,onPagination:function(a){return!0}}},getInitialState:function(){return{themeClassKey:"pagination"}},render:function(){return React.createElement("ul",{className:this.className()},this.renderPreviousButton(),this.renderPageButtons(),this.renderNextButton())},renderPreviousButton:function(){var a=this.props.page<=1;return React.createElement(PaginationItem,{disabled:a,iconType:"icon.left",onClick:this.navigateToPrevious})},renderNextButton:function(){var a=this.props.page>=this.lastPage();return React.createElement(PaginationItem,{disabled:a,iconType:"icon.right",onClick:this.navigateToNext})},renderPageButtons:function(){for(var a=this.props.window,b=Math.max(1,this.props.page-a),c=Math.min(this.lastPage(),this.props.page+a),d=[],e=b;c>=e;e++)d.push(this.renderPageButton(e));return d},renderPageButton:function(a){var b=this.props.page==a;return React.createElement(PaginationItem,{active:b,text:a,onClick:this.navigateTo.bind(this,a)})},lastPage:function(){return Math.ceil(this.props.count/this.props.perPage)},navigateToPrevious:function(){var a=Math.max(1,this.props.page-1);this.navigateTo(a)},navigateToNext:function(){var a=Math.min(this.lastPage(),this.props.page+1);this.navigateTo(a)},navigateTo:function(a){this.props.onPagination(a)}}),PaginationItem=React.createClass({displayName:"PaginationItem",mixins:[CssClassMixin],propTypes:{disabled:React.PropTypes.bool,active:React.PropTypes.bool,iconType:React.PropTypes.string,text:React.PropTypes.string,onClick:React.PropTypes.func},getDefaultProps:function(){return{disabled:!1,active:!1,iconType:null,text:"",onClick:function(a){return!0}}},getInitialState:function(){var a="pagination.item";return this.props.disabled&&(a+=" pagination.item.disabled"),this.props.active&&(a+=" pagination.item.active"),{themeClassKey:a}},render:function(){return React.createElement("li",{className:this.className(),onClick:this.props.onClick},React.createElement("a",{href:"#!"},this.props.text,this.props.iconType?this.renderIcon():""))},renderIcon:function(){return React.createElement(Icon,{type:this.props.iconType})}});